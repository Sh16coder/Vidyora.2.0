<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSphere Pro | Dashboard</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Inter:wght@300;400;500&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/animations.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        .dashboard {
            min-height: 100vh;
            background: var(--light);
            position: relative;
        }
        
        .dark .dashboard {
            background: var(--dark-bg);
        }
        
        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: var(--space-6) 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--space-4);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .logo-icon {
            font-size: 2rem;
            animation: rotate3d 8s infinite linear;
        }
        
        .logo-text h1 {
            font-size: var(--text-xl);
            font-weight: 700;
            margin-bottom: var(--space-1);
        }
        
        .logo-text p {
            font-size: var(--text-xs);
            opacity: 0.9;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-name {
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        
        .user-class {
            font-size: var(--text-sm);
            opacity: 0.9;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--white);
            cursor: pointer;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-avatar-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--white) 0%, var(--gray-200) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.25rem;
            cursor: pointer;
        }
        
        /* Logout Dropdown */
        .logout-dropdown {
            position: relative;
        }
        
        .logout-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            min-width: 200px;
            display: none;
            overflow: hidden;
            z-index: var(--z-dropdown);
            animation: slideUp 0.2s ease-out;
        }
        
        .dark .logout-menu {
            background: var(--dark-surface);
        }
        
        .logout-menu.show {
            display: block;
        }
        
        .logout-menu-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--gray-700);
            text-decoration: none;
            transition: all var(--transition-fast);
        }
        
        .dark .logout-menu-item {
            color: var(--gray-300);
        }
        
        .logout-menu-item:hover {
            background: var(--gray-100);
        }
        
        .dark .logout-menu-item:hover {
            background: var(--gray-800);
        }
        
        .logout-menu-item.logout {
            color: var(--danger);
            border-top: 1px solid var(--gray-200);
        }
        
        .dark .logout-menu-item.logout {
            border-top-color: var(--gray-700);
        }
        
        /* Main Content */
        .dashboard-main {
            padding: var(--space-8) var(--space-4);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Welcome Section */
        .welcome-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            display: grid;
            grid-template-columns: 1fr auto;
            gap: var(--space-6);
            align-items: center;
            animation: slideUp 0.6s ease-out;
        }
        
        @media (max-width: 768px) {
            .welcome-section {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
        
        .welcome-text h2 {
            font-size: var(--text-3xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
            color: var(--gray-900);
        }
        
        .dark .welcome-text h2 {
            color: var(--gray-100);
        }
        
        .welcome-text p {
            color: var(--gray-600);
            font-size: var(--text-lg);
        }
        
        .dark .welcome-text p {
            color: var(--gray-400);
        }
        
        .class-info-card {
            background: var(--white);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            min-width: 250px;
        }
        
        .dark .class-info-card {
            background: var(--dark-surface);
        }
        
        .class-info-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }
        
        .class-info-item:last-child {
            margin-bottom: 0;
        }
        
        .class-info-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.25rem;
        }
        
        .class-info-content h4 {
            font-weight: 600;
            margin-bottom: var(--space-1);
            color: var(--gray-800);
        }
        
        .dark .class-info-content h4 {
            color: var(--gray-200);
        }
        
        .class-info-content p {
            color: var(--gray-600);
            font-size: var(--text-sm);
        }
        
        .dark .class-info-content p {
            color: var(--gray-400);
        }
        
        /* Subjects Section */
        .subjects-section {
            margin-bottom: var(--space-8);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }
        
        .section-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .dark .section-title {
            color: var(--gray-100);
        }
        
        .stream-badge {
            background: var(--gradient-primary);
            color: var(--white);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 600;
        }
        
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-6);
        }
        
        .subject-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }
        
        .subject-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .dark .subject-card {
            background: var(--dark-surface);
        }
        
        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-2xl);
        }
        
        .subject-card:hover .subject-icon {
            transform: scale(1.1);
        }
        
        .subject-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        .subject-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            transition: transform var(--transition-normal);
        }
        
        .subject-title h3 {
            font-weight: 600;
            margin-bottom: var(--space-1);
            color: var(--gray-900);
        }
        
        .dark .subject-title h3 {
            color: var(--gray-100);
        }
        
        .subject-title p {
            color: var(--gray-600);
            font-size: var(--text-sm);
        }
        
        .dark .subject-title p {
            color: var(--gray-400);
        }
        
        .subject-description {
            color: var(--gray-600);
            margin-bottom: var(--space-4);
            font-size: var(--text-sm);
            line-height: 1.6;
        }
        
        .dark .subject-description {
            color: var(--gray-400);
        }
        
        .subject-action {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .access-link {
            color: var(--primary);
            font-weight: 500;
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .access-link:hover {
            text-decoration: underline;
        }
        
        /* Quick Links */
        .quick-links-section {
            margin-bottom: var(--space-8);
        }
        
        .quick-links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-4);
        }
        
        .quick-link {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            background: var(--white);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            text-decoration: none;
            color: var(--gray-700);
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
        }
        
        .dark .quick-link {
            background: var(--dark-surface);
            color: var(--gray-300);
        }
        
        .quick-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: var(--primary);
        }
        
        .quick-link-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.25rem;
        }
        
        /* Footer */
        .dashboard-footer {
            background: var(--gray-900);
            color: var(--white);
            padding: var(--space-6) 0;
            text-align: center;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--space-6);
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: var(--gray-400);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        .footer-link:hover {
            color: var(--white);
        }
        
        .copyright {
            color: var(--gray-500);
            font-size: var(--text-sm);
        }
        
        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            gap: var(--space-4);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray-300);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-4);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            color: var(--gray-400);
            margin-bottom: var(--space-4);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }
            
            .user-info {
                text-align: center;
            }
            
            .welcome-section {
                padding: var(--space-6);
            }
            
            .subjects-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-links-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .quick-links-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-2);
            }
        }
        
        /* Color classes for subject icons */
        .icon-math { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .icon-physics { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .icon-chemistry { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .icon-english { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .icon-hindi { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .icon-computer { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
        .icon-accountancy { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
        .icon-business { background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); }
        .icon-economics { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .icon-informatics { background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="logo-text">
                        <h1>EduSphere Pro</h1>
                        <p>Student Learning Portal</p>
                    </div>
                </div>
                
                <div class="user-section">
                    <div class="user-info">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-class" id="userClass">Class: --</div>
                    </div>
                    
                    <div class="logout-dropdown">
                        <div class="user-avatar" id="userAvatarBtn">
                            <div class="user-avatar-placeholder" id="avatarPlaceholder">
                                <i class="fas fa-user"></i>
                            </div>
                            <img id="userAvatar" style="display: none;" alt="User Avatar">
                        </div>
                        
                        <div class="logout-menu" id="logoutMenu">
                            <a href="profile.html" class="logout-menu-item">
                                <i class="fas fa-user-edit"></i>
                                Edit Profile
                            </a>
                            <a href="#" class="logout-menu-item">
                                <i class="fas fa-cog"></i>
                                Settings
                            </a>
                            <a href="#" class="logout-menu-item">
                                <i class="fas fa-question-circle"></i>
                                Help & Support
                            </a>
                            <div class="logout-menu-item logout" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Loading State -->
            <div id="loadingState" class="loading-state">
                <div class="loading-spinner"></div>
                <p>Loading your dashboard...</p>
            </div>
            
            <!-- Dashboard Content (Hidden by default) -->
            <div id="dashboardContent" style="display: none;">
                <!-- Welcome Section -->
                <section class="welcome-section">
                    <div class="welcome-text">
                        <h2 id="welcomeMessage">Welcome back, Student!</h2>
                        <p id="welcomeSubtitle">Here's your personalized learning dashboard for today</p>
                    </div>
                    
                    <div class="class-info-card">
                        <div class="class-info-item">
                            <div class="class-info-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="class-info-content">
                                <h4 id="displayClass">Class: --</h4>
                                <p>Your current class</p>
                            </div>
                        </div>
                        <div class="class-info-item">
                            <div class="class-info-icon">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="class-info-content">
                                <h4 id="classTeacher">Teacher: --</h4>
                                <p>Class teacher</p>
                            </div>
                        </div>
                        <div class="class-info-item">
                            <div class="class-info-icon">
                                <i class="fas fa-stream"></i>
                            </div>
                            <div class="class-info-content">
                                <h4 id="studentStream">Stream: --</h4>
                                <p>Academic stream</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Subjects Section -->
                <section class="subjects-section">
                    <div class="section-header">
                        <h2 class="section-title">Your Subjects</h2>
                        <div class="stream-badge" id="streamBadge">Science</div>
                    </div>
                    
                    <div class="subjects-grid" id="subjectsGrid">
                        <!-- Subjects will be dynamically inserted here -->
                    </div>
                </section>
                
                <!-- Quick Links -->
                <section class="quick-links-section">
                    <div class="section-header">
                        <h2 class="section-title">Quick Access</h2>
                    </div>
                    
                    <div class="quick-links-grid">
                        <a href="https://adminsblog.vercel.app/" target="_blank" rel="noopener noreferrer" class="quick-link">
                            <div class="quick-link-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <span>Study Materials</span>
                        </a>
                        
                        <a href="#" class="quick-link">
                            <div class="quick-link-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <span>Academic Calendar</span>
                        </a>
                        
                        <a href="#" class="quick-link">
                            <div class="quick-link-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <span>Progress Report</span>
                        </a>
                        
                        <a href="#" class="quick-link">
                            <div class="quick-link-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <span>Help Center</span>
                        </a>
                    </div>
                </section>
            </div>
            
            <!-- Empty State (No profile) -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h2>Complete Your Profile</h2>
                <p>You need to complete your profile to access the dashboard</p>
                <a href="profile.html" class="btn btn-primary" style="margin-top: var(--space-4);">
                    <i class="fas fa-user-edit"></i>
                    Complete Profile
                </a>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="dashboard-footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#" class="footer-link">Privacy Policy</a>
                    <a href="#" class="footer-link">Terms of Service</a>
                    <a href="#" class="footer-link">Contact Us</a>
                    <a href="#" class="footer-link">About EduSphere</a>
                </div>
                <div class="copyright">
                    © 2024 EduSphere Pro. All rights reserved. v1.0.0
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="js/firebase-config.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
        // Class teacher mapping
        const classTeachers = {
            '9A': 'Mrs. Sharma',
            '9B': 'Mr. Verma',
            '10A': 'Ms. Patel',
            '10B': 'Mr. Singh',
            '11A': 'Dr. Kumar',
            '11B': 'Mrs. Gupta',
            '12A': 'Mr. Joshi',
            '12B': 'Ms. Reddy'
        };
        
        // Stream detection
        function getStreamFromClass(className) {
            const scienceClasses = ['9A', '9B', '10A', '10B', '11A', '12A'];
            const commerceClasses = ['11B', '12B'];
            
            if (scienceClasses.includes(className)) {
                return {
                    name: 'Science',
                    subjects: [
                        { name: 'Mathematics', icon: 'fa-calculator', color: 'icon-math', desc: 'Algebra, Calculus, Geometry' },
                        { name: 'Physics', icon: 'fa-atom', color: 'icon-physics', desc: 'Mechanics, Thermodynamics, Optics' },
                        { name: 'Chemistry', icon: 'fa-flask', color: 'icon-chemistry', desc: 'Organic, Inorganic, Physical Chemistry' },
                        { name: 'English', icon: 'fa-language', color: 'icon-english', desc: 'Literature, Grammar, Composition' },
                        { name: 'Hindi', icon: 'fa-book', color: 'icon-hindi', desc: 'साहित्य, व्याकरण, रचना' },
                        { name: 'Computer Science', icon: 'fa-laptop-code', color: 'icon-computer', desc: 'Programming, Databases, Networks' }
                    ]
                };
            } else if (commerceClasses.includes(className)) {
                return {
                    name: 'Commerce',
                    subjects: [
                        { name: 'Accountancy', icon: 'fa-file-invoice-dollar', color: 'icon-accountancy', desc: 'Financial Accounting, Book Keeping' },
                        { name: 'Business Studies', icon: 'fa-briefcase', color: 'icon-business', desc: 'Management, Marketing, Finance' },
                        { name: 'Economics', icon: 'fa-chart-line', color: 'icon-economics', desc: 'Microeconomics, Macroeconomics' },
                        { name: 'English', icon: 'fa-language', color: 'icon-english', desc: 'Literature, Grammar, Composition' },
                        { name: 'Hindi', icon: 'fa-book', color: 'icon-hindi', desc: 'साहित्य, व्याकरण, रचना' },
                        { name: 'Informatics Practices', icon: 'fa-database', color: 'icon-informatics', desc: 'Data Management, Programming' }
                    ]
                };
            }
            return null;
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            const ui = window.ui || new UI();
            
            // Check authentication
            firebase.auth().onAuthStateChanged(async (user) => {
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // Show loading state
                const loadingState = document.getElementById('loadingState');
                const dashboardContent = document.getElementById('dashboardContent');
                const emptyState = document.getElementById('emptyState');
                
                try {
                    // Fetch user profile from Firestore
                    const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        
                        // Update user info in header
                        document.getElementById('userName').textContent = userData.fullName || 'Student';
                        document.getElementById('userClass').textContent = `Class: ${userData.class || '--'}`;
                        
                        // Update welcome section
                        document.getElementById('welcomeMessage').textContent = `Welcome back, ${userData.fullName || 'Student'}!`;
                        document.getElementById('displayClass').textContent = `Class: ${userData.class || '--'}`;
                        document.getElementById('classTeacher').textContent = `Teacher: ${classTeachers[userData.class] || '--'}`;
                        
                        // Determine stream
                        const stream = getStreamFromClass(userData.class);
                        if (stream) {
                            document.getElementById('studentStream').textContent = `Stream: ${stream.name}`;
                            document.getElementById('streamBadge').textContent = stream.name;
                            
                            // Generate subject cards
                            const subjectsGrid = document.getElementById('subjectsGrid');
                            subjectsGrid.innerHTML = '';
                            
                            stream.subjects.forEach((subject, index) => {
                                const subjectCard = document.createElement('div');
                                subjectCard.className = 'subject-card';
                                subjectCard.style.animationDelay = `${index * 100}ms`;
                                subjectCard.innerHTML = `
                                    <div class="subject-header">
                                        <div class="subject-icon ${subject.color}">
                                            <i class="fas ${subject.icon}"></i>
                                        </div>
                                        <div class="subject-title">
                                            <h3>${subject.name}</h3>
                                            <p>Core Subject</p>
                                        </div>
                                    </div>
                                    <p class="subject-description">${subject.desc}</p>
                                    <div class="subject-action">
                                        <a href="https://adminsblog.vercel.app/" target="_blank" rel="noopener noreferrer" class="access-link">
                                            Access Materials
                                            <i class="fas fa-arrow-right"></i>
                                        </a>
                                    </div>
                                `;
                                subjectsGrid.appendChild(subjectCard);
                            });
                        }
                        
                        // Update avatar if exists
                        if (userData.profileImage) {
                            const avatarImg = document.getElementById('userAvatar');
                            const placeholder = document.getElementById('avatarPlaceholder');
                            
                            avatarImg.src = userData.profileImage;
                            placeholder.style.display = 'none';
                            avatarImg.style.display = 'block';
                        }
                        
                        // Show dashboard content
                        loadingState.style.display = 'none';
                        dashboardContent.style.display = 'block';
                        
                    } else {
                        // No profile found
                        loadingState.style.display = 'none';
                        emptyState.style.display = 'block';
                    }
                    
                } catch (error) {
                    console.error('Error loading dashboard:', error);
                    loadingState.innerHTML = `
                        <div class="error-message" style="display: flex;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Error loading dashboard. Please try again.</span>
                        </div>
                        <a href="login.html" class="btn btn-primary">Return to Login</a>
                    `;
                }
            });
            
            // Logout dropdown toggle
            document.getElementById('userAvatarBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('logoutMenu').classList.toggle('show');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                document.getElementById('logoutMenu').classList.remove('show');
            });
            
            // Logout handler
            document.getElementById('logoutBtn').addEventListener('click', async function(e) {
                e.preventDefault();
                
                if (confirm('Are you sure you want to logout?')) {
                    try {
                        await logoutUser();
                        window.location.href = 'login.html';
                    } catch (error) {
                        console.error('Logout error:', error);
                        alert('Error logging out. Please try again.');
                    }
                }
            });
            
            // Subject card click handlers
            document.addEventListener('click', function(e) {
                if (e.target.closest('.subject-card')) {
                    const card = e.target.closest('.subject-card');
                    card.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        card.style.transform = '';
                    }, 150);
                }
            });
        });
    </script>
</body>
</html>
